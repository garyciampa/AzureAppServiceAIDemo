<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NovaTech AI Demo - Search & Chat</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        .user-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #ffffff20;
        }
        .user-avatar-large {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #ffffff20;
        }
        .avatar-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .avatar-placeholder {
            color: white;
            font-weight: bold;
            font-size: 14px;
        }
        .avatar-placeholder-large {
            color: white;
            font-weight: bold;
            font-size: 18px;
            background-color: #2196F3;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        .chat-container {
            height: 500px;
            overflow-y: auto;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 1rem;
            background-color: #f8f9fa;
        }
        .input-container {
            background-color: white;
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .user-info-card {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border: 1px solid #e1bee7;
        }
        .loading {
            display: none;
        }
        .message-user {
            background: linear-gradient(135deg, #2196F3, #1976D2);
            color: white;
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 1rem;
            border-bottom-right-radius: 0.3rem;
            box-shadow: 0 2px 4px rgba(33, 150, 243, 0.3);
        }
        .message-ai {
            background: linear-gradient(135deg, #f5f5f5, #e0e0e0);
            color: #333;
            margin-bottom: 1rem;
            padding: 1rem;
            border-radius: 1rem;
            border-bottom-left-radius: 0.3rem;
            border: 1px solid #ddd;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .prompt-input {
            border: 2px solid #e9ecef;
            border-radius: 0.5rem;
            transition: border-color 0.3s ease;
        }
        .prompt-input:focus {
            border-color: #2196F3;
            box-shadow: 0 0 0 0.2rem rgba(33, 150, 243, 0.25);
        }
        .btn-send {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
        }
        .btn-send:hover {
            background: linear-gradient(135deg, #45a049, #3d8b40);
        }
        .btn-clear {
            background: linear-gradient(135deg, #ff9800, #f57c00);
            border: none;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
        }
        .btn-clear:hover {
            background: linear-gradient(135deg, #f57c00, #ef6c00);
            color: white;
        }
        
        /* Message styling */
        .message-user .card {
            border-left: 4px solid #2196F3;
        }
        .message-ai .card {
            border-left: 4px solid #4CAF50;
        }
        .card-body {
            line-height: 1.6;
            white-space: pre-line;
        }
        #personaSelection {
            display: none;
        }
        /* Enhanced UI section styling for better visual separation */
        .traditional-mode-section {
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 25%, #e8eaf6 100%);
            color: #1565c0;
            border: 2px solid #1976d2;
            border-radius: 0.5rem;
        }
        .traditional-mode-section .text-primary {
            color: #0d47a1 !important;
            font-weight: 600;
        }
        .traditional-mode-section .text-muted {
            color: #424242 !important;
        }
        .traditional-mode-section .form-label {
            color: #1565c0;
            text-shadow: none;
        }
        
        .semantic-kernel-section {
            background: linear-gradient(135deg, #e8f5e8 0%, #f1f8e9 25%, #e0f2f1 100%);
            color: #2e7d32;
            border: 2px solid #388e3c;
            border-radius: 0.5rem;
        }
        .semantic-kernel-section .text-info {
            color: #1b5e20 !important;
            font-weight: 600;
        }
        .semantic-kernel-section .text-muted {
            color: #424242 !important;
        }
        .semantic-kernel-section .form-label {
            color: #2e7d32;
            text-shadow: none;
        }
        
        /* Persona section inherits from active architecture */
        .persona-section {
            background: linear-gradient(135deg, #fef7e0 0%, #fff8e1 25%, #fffde7 100%);
            border: 2px solid #f57c00;
            border-radius: 0.5rem;
            color: #ef6c00;
        }
        .persona-section .text-muted {
            color: #424242 !important;
        }
        .persona-section .form-label {
            color: #ef6c00;
            text-shadow: none;
        }
        .persona-section.traditional-theme {
            background: linear-gradient(135deg, #fef7e0 0%, #fff8e1 25%, #fffde7 100%);
            border: 2px solid #f57c00;
            color: #ef6c00;
        }
        .persona-section.traditional-theme .text-muted {
            color: #424242 !important;
        }
        .persona-section.semantic-kernel-theme {
            background: linear-gradient(135deg, #fef7e0 0%, #fff8e1 25%, #fffde7 100%);
            border: 2px solid #f57c00;
            color: #ef6c00;
        }
        .persona-section.semantic-kernel-theme .text-muted {
            color: #424242 !important;
        }
        
        /* Selection styling with enhanced readability */
        .persona-section.traditional-theme input[type="radio"]:checked + label {
            background: linear-gradient(135deg, #1976d2, #1565c0) !important;
            color: white !important;
            border: 2px solid #0d47a1 !important;
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        .persona-section.semantic-kernel-theme input[type="radio"]:checked + label {
            background: linear-gradient(135deg, #388e3c, #2e7d32) !important;
            color: white !important;
            border: 2px solid #1b5e20 !important;
            font-weight: 600;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        
        /* Architecture section button selected states */
        .traditional-mode-section input[type="radio"]:checked + label {
            color: #1565c0 !important;
        }
        .semantic-kernel-section input[type="radio"]:checked + label {
            color: #2e7d32 !important;
        }
        
        /* Button styling improvements for consistent behavior across all sections */
        .traditional-mode-section .btn-outline-primary,
        .traditional-mode-section .btn-outline-success {
            border-color: #1976d2;
            color: #1565c0;
            font-weight: 500;
            background-color: transparent;
        }
        .traditional-mode-section .btn-outline-primary:hover,
        .traditional-mode-section .btn-outline-success:hover {
            background-color: #1565c0;
            border-color: #1565c0;
            color: white;
        }
        .traditional-mode-section input[type="radio"]:checked + label {
            background-color: white !important;
            border-color: #1565c0 !important;
            color: #1565c0 !important;
            font-weight: 600;
        }
        
        .semantic-kernel-section .btn-outline-info,
        .semantic-kernel-section .btn-outline-warning {
            border-color: #2e7d32;
            color: #2e7d32;
            font-weight: 500;
            background-color: transparent;
        }
        .semantic-kernel-section .btn-outline-info:hover,
        .semantic-kernel-section .btn-outline-warning:hover {
            background-color: #2e7d32;
            border-color: #2e7d32;
            color: white;
        }
        .semantic-kernel-section input[type="radio"]:checked + label {
            background-color: white !important;
            border-color: #2e7d32 !important;
            color: #2e7d32 !important;
            font-weight: 600;
        }
        
        /* Persona button styling with consistent orange theme */
        .persona-section .btn-outline-warning,
        .persona-section .btn-outline-info {
            border-color: #f57c00;
            color: #ef6c00;
            font-weight: 500;
            background-color: transparent;
        }
        .persona-section .btn-outline-warning:hover,
        .persona-section .btn-outline-info:hover {
            background-color: #ef6c00;
            border-color: #ef6c00;
            color: white;
        }
        .persona-section input[type="radio"]:checked + label {
            background-color: white !important;
            border-color: #ef6c00 !important;
            color: #ef6c00 !important;
            font-weight: 600;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="https://www.novatech.com/" target="_blank" rel="noopener">
                <i class="bi bi-robot me-2"></i>NovaTech AI Demo
            </a>
            <div class="navbar-nav ms-auto d-flex align-items-center">
                <!-- User Avatar and Info -->
                <div class="dropdown me-3">
                    <button class="btn btn-outline-light dropdown-toggle d-flex align-items-center" type="button" id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                        <div class="user-avatar me-2">
                            {% if user.picture %}
                                <img src="{{ user.picture }}" alt="User Avatar" class="avatar-img">
                            {% else %}
                                <div class="avatar-placeholder">
                                    {{ user.name[0] if user.name else 'U' }}
                                </div>
                            {% endif %}
                        </div>
                        <span class="d-none d-md-inline">{{ user.name or user.preferred_username }}</span>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                        <li><h6 class="dropdown-header">User Information</h6></li>
                        <li><span class="dropdown-item-text"><strong>Name:</strong> {{ user.name or 'N/A' }}</span></li>
                        <li><span class="dropdown-item-text"><strong>Email:</strong> {{ user.preferred_username or user.email or 'N/A' }}</span></li>
                        <li><span class="dropdown-item-text"><strong>Tenant:</strong> {{ user.tid or 'N/A' }}</span></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item text-danger" href="{{ url_for('logout') }}">
                            <i class="bi bi-box-arrow-right me-2"></i>Logout
                        </a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- User Info Card -->
        <div class="row">
            <div class="col-12">
                <div class="user-info-card">
                    <div class="d-flex align-items-center">
                        <div class="user-avatar-large me-3">
                            {% if user.picture %}
                                <img src="{{ user.picture }}" alt="User Avatar" class="avatar-img">
                            {% else %}
                                <div class="avatar-placeholder-large">
                                    {{ user.name[0] if user.name else 'U' }}
                                </div>
                            {% endif %}
                        </div>
                        <div>
                            <h5 class="mb-1">Welcome, {{ user.name or user.preferred_username }}!</h5>
                            <p class="mb-0 text-muted">
                                <i class="bi bi-envelope me-1"></i>{{ user.preferred_username or user.email or 'No email available' }}
                                {% if user.job_title %}
                                <span class="ms-3"><i class="bi bi-briefcase me-1"></i>{{ user.job_title }}</span>
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="row">
            <!-- Input Section -->
            <div class="col-md-6">
                <div class="input-container">
                    <h5 class="mb-3">
                        <i class="bi bi-chat-dots me-2 text-primary"></i>NovaTech AI Query
                    </h5>
                    <form id="promptForm">
                        <!-- Traditional Mode Selection -->
                        <div class="mb-4 p-3 border rounded traditional-mode-section">
                            <label class="form-label fw-semibold text-primary">
                                <i class="bi bi-gear me-1"></i>Traditional Architecture:
                            </label>
                            <div class="btn-group w-100" role="group" aria-label="Mode selection">
                                <input type="radio" class="btn-check" name="modeSelection" id="searchMode" value="search" checked>
                                <label class="btn btn-outline-primary" for="searchMode">
                                    <i class="bi bi-search me-1"></i>Search Documents
                                </label>
                                
                                <input type="radio" class="btn-check" name="modeSelection" id="chatMode" value="chat">
                                <label class="btn btn-outline-success" for="chatMode">
                                    <i class="bi bi-chat-text me-1"></i>AI Chat + Search (RAG)
                                </label>
                            </div>
                            <small class="text-muted d-block mt-2">
                                <strong>Search:</strong> Direct document retrieval | 
                                <strong>Chat + Search:</strong> AI responses enhanced with relevant documents
                            </small>
                        </div>

                        <!-- Semantic Kernel Mode Selection -->
                        <div class="mb-4 p-3 border rounded semantic-kernel-section">
                            <label class="form-label fw-semibold text-info">
                                <i class="bi bi-gear-wide-connected me-1"></i>Semantic Kernel Architecture:
                            </label>
                            <div class="btn-group w-100" role="group" aria-label="Semantic Kernel mode selection">
                                <input type="radio" class="btn-check" name="skModeSelection" id="skSearchMode" value="sk_search">
                                <label class="btn btn-outline-info" for="skSearchMode">
                                    <i class="bi bi-search-heart me-1"></i>SK Search
                                </label>
                                
                                <input type="radio" class="btn-check" name="skModeSelection" id="skChatMode" value="sk_chat">
                                <label class="btn btn-outline-warning" for="skChatMode">
                                    <i class="bi bi-robot me-1"></i>SK AI Chat + RAG
                                </label>
                            </div>
                            <small class="text-muted d-block mt-2">
                                <strong>SK Search:</strong> Semantic Kernel powered document search | 
                                <strong>SK AI Chat + RAG:</strong> Modern AI orchestration with plugin architecture
                            </small>
                        </div>

                        <!-- Persona Selection (visible only in Chat modes) -->
                        <div class="mb-4 p-3 border rounded persona-section" id="personaSelection">
                            <label class="form-label fw-semibold" id="personaLabel">
                                <i class="bi bi-person-badge me-1"></i>Choose Persona:
                            </label>
                            <div class="btn-group w-100" role="group" aria-label="Persona selection">
                                <input type="radio" class="btn-check" name="personaSelection" id="analystPersona" value="analyst" checked>
                                <label class="btn btn-outline-warning" for="analystPersona">
                                    <i class="bi bi-graph-up me-1"></i>Financial Analyst
                                </label>
                                
                                <input type="radio" class="btn-check" name="personaSelection" id="ceoPersona" value="ceo">
                                <label class="btn btn-outline-info" for="ceoPersona">
                                    <i class="bi bi-briefcase me-1"></i>CEO
                                </label>
                            </div>
                            <small class="text-muted d-block mt-2">
                                <strong>Analyst:</strong> Ask probing questions during earnings calls | 
                                <strong>CEO:</strong> Provide strategic insights and company information
                            </small>
                        </div>
                        
                        <div class="mb-3">
                            <label for="promptInput" class="form-label fw-semibold" id="promptLabel">Enter your search query:</label>
                            <textarea class="form-control prompt-input" id="promptInput" rows="5" 
                                placeholder="Search for documents in the NovaTech knowledge base..."></textarea>
                        </div>
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-send text-white">
                                <span class="loading spinner-border spinner-border-sm me-2" role="status"></span>
                                <i class="bi bi-send me-1"></i>Send
                            </button>
                            <button type="button" class="btn btn-clear" id="clearInputBtn">
                                <i class="bi bi-eraser me-1"></i>Clear
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Output Section -->
            <div class="col-md-6">
                <div class="input-container">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5 class="mb-0" id="outputTitle">
                            <i class="bi bi-file-text me-2 text-success"></i>NovaTech AI Response
                        </h5>
                        <button class="btn btn-outline-danger btn-sm" id="clearOutputBtn">
                            <i class="bi bi-trash me-1"></i>Clear History
                        </button>
                    </div>
                    <div id="outputArea" class="chat-container">
                        <div class="text-center text-muted py-4" id="initialMessage">
                            <i class="bi bi-robot display-6 mb-2"></i>
                            <p>Ready to help!<br>Choose search or chat mode and enter your query.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Wait for DOM to be ready
        document.addEventListener('DOMContentLoaded', function() {
            
            // Add event listeners for clear buttons
            document.getElementById('clearInputBtn').addEventListener('click', clearInput);
            document.getElementById('clearOutputBtn').addEventListener('click', clearOutput);
            
            // Add event listeners for mode switching
            document.getElementById('searchMode').addEventListener('change', updateModeUI);
            document.getElementById('chatMode').addEventListener('change', updateModeUI);
            document.getElementById('skSearchMode').addEventListener('change', updateModeUI);
            document.getElementById('skChatMode').addEventListener('change', updateModeUI);
            
            // Initialize UI
            updateModeUI();
            
            // Form submission handler
            document.getElementById('promptForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const promptInput = document.getElementById('promptInput');
                const outputArea = document.getElementById('outputArea');
                const loadingSpinner = document.querySelector('.loading');
                const submitButton = document.querySelector('button[type="submit"]');
                
                const prompt = promptInput.value.trim();
                const mode = document.querySelector('input[name="modeSelection"]:checked')?.value;
                const skMode = document.querySelector('input[name="skModeSelection"]:checked')?.value;
                const persona = document.querySelector('input[name="personaSelection"]:checked')?.value || 'analyst';
                
                // Determine which mode is active
                const activeMode = skMode || mode;
                
                if (!prompt) {
                    alert('Please enter a query');
                    return;
                }

                // Show loading state
                loadingSpinner.style.display = 'inline-block';
                submitButton.disabled = true;

                try {
                    // Determine endpoint based on mode
                    let endpoint;
                    if (activeMode === 'sk_search') {
                        endpoint = '/process_sk_search';
                    } else if (activeMode === 'sk_chat') {
                        endpoint = '/process_sk_chat';
                    } else if (activeMode === 'search') {
                        endpoint = '/process_search';
                    } else {
                        endpoint = '/process_chat';
                    }

                    const response = await fetch(endpoint, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ 
                            prompt: prompt,
                            persona: persona
                        })
                    });

                    const data = await response.json();

                    if (response.ok) {
                        // Clear initial message if it exists
                        const initialMessage = outputArea.querySelector('.text-center');
                        if (initialMessage) {
                            outputArea.innerHTML = '';
                        }
                        
                        // Determine message types based on mode
                        let userMessageType, aiResponseType, responseIcon;
                        
                        if (activeMode === 'sk_search') {
                            userMessageType = 'Semantic Kernel Query';
                            aiResponseType = 'Semantic Kernel Query Results';
                            responseIcon = 'search-heart';
                        } else if (activeMode === 'sk_chat') {
                            userMessageType = 'Semantic Kernel Prompt';
                            aiResponseType = 'Semantic Kernel Prompt Results';
                            responseIcon = 'robot';
                        } else if (activeMode === 'search') {
                            userMessageType = 'Search Query';
                            aiResponseType = 'Query Results';
                            responseIcon = 'file-text';
                        } else {
                            userMessageType = 'AI Prompt';
                            aiResponseType = 'Prompt Results';
                            responseIcon = 'robot';
                        }
                        
                        // Add user prompt to output with dynamic styling
                        const userMessage = document.createElement('div');
                        userMessage.className = 'message-user mb-3';
                        userMessage.innerHTML = `
                            <div class="card border-primary">
                                <div class="card-header bg-primary text-white">
                                    <i class="bi bi-person-circle me-2"></i>
                                    <strong>${userMessageType}:</strong>
                                </div>
                                <div class="card-body">
                                    ${prompt.replace(/\n/g, '<br>')}
                                </div>
                            </div>
                        `;
                        
                        // Add AI response to output with dynamic styling
                        const aiResponse = document.createElement('div');
                        aiResponse.className = 'message-ai mb-3';
                        aiResponse.innerHTML = `
                            <div class="card border-success">
                                <div class="card-header bg-success text-white">
                                    <i class="bi bi-${responseIcon} me-2"></i>
                                    <strong>${aiResponseType}:</strong>
                                </div>
                                <div class="card-body">
                                    ${data.response.replace(/\n/g, '<br>')}
                                </div>
                            </div>
                        `;
                        
                        outputArea.appendChild(userMessage);
                        outputArea.appendChild(aiResponse);
                        outputArea.scrollTop = outputArea.scrollHeight;
                        
                        // Clear input after successful send
                        promptInput.value = '';
                    } else {
                        throw new Error(data.error || 'An error occurred');
                    }
                } catch (error) {
                    const errorMessage = document.createElement('div');
                    errorMessage.className = 'alert alert-danger';
                    errorMessage.innerHTML = `
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        <strong>Error:</strong> ${error.message}
                    `;
                    
                    // Clear initial message if it exists
                    const initialMessage = outputArea.querySelector('.text-center');
                    if (initialMessage) {
                        outputArea.innerHTML = '';
                    }
                    
                    outputArea.appendChild(errorMessage);
                } finally {
                    // Hide loading state
                    loadingSpinner.style.display = 'none';
                    submitButton.disabled = false;
                }
            });
        });

        // Function to update UI based on selected mode
        function updateModeUI() {
            const isSearchMode = document.getElementById('searchMode').checked;
            const isChatMode = document.getElementById('chatMode').checked;
            const isSkSearchMode = document.getElementById('skSearchMode').checked;
            const isSkChatMode = document.getElementById('skChatMode').checked;
            
            const promptInput = document.getElementById('promptInput');
            const promptLabel = document.getElementById('promptLabel');
            const outputTitle = document.getElementById('outputTitle');
            const personaSelection = document.getElementById('personaSelection');
            
            // Clear other mode selections when one is selected
            if (isSkSearchMode || isSkChatMode) {
                document.getElementById('searchMode').checked = false;
                document.getElementById('chatMode').checked = false;
            }
            if (isSearchMode || isChatMode) {
                document.getElementById('skSearchMode').checked = false;
                document.getElementById('skChatMode').checked = false;
            }
            
            // Update UI based on active mode
            if (isSkSearchMode) {
                promptInput.placeholder = 'Search documents using Semantic Kernel...';
                promptLabel.textContent = 'Enter your Semantic Kernel search query:';
                personaSelection.style.display = 'none';
                if (outputTitle) {
                    outputTitle.innerHTML = '<i class="bi bi-search-heart me-2 text-info"></i>Semantic Kernel Query Results';
                }
            } else if (isSkChatMode) {
                promptInput.placeholder = 'Ask me anything using Semantic Kernel AI orchestration...';
                promptLabel.textContent = 'Enter your question for Semantic Kernel AI + RAG:';
                personaSelection.style.display = 'block';
                if (outputTitle) {
                    outputTitle.innerHTML = '<i class="bi bi-robot me-2 text-warning"></i>Semantic Kernel Prompt Results';
                }
            } else if (isSearchMode) {
                promptInput.placeholder = 'Search for documents in the NovaTech knowledge base...';
                promptLabel.textContent = 'Enter your search query:';
                personaSelection.style.display = 'none';
                if (outputTitle) {
                    outputTitle.innerHTML = '<i class="bi bi-search me-2"></i>Query Results';
                }
            } else if (isChatMode) {
                promptInput.placeholder = 'Ask me anything about the documents in the knowledge base...';
                promptLabel.textContent = 'Enter your question for AI + Search:';
                personaSelection.style.display = 'block';
                if (outputTitle) {
                    outputTitle.innerHTML = '<i class="bi bi-robot me-2"></i>Prompt Results';
                }
            }
            
            // Update persona styling when persona section is visible
            updatePersonaUI();
        }

        function updatePersonaUI() {
            const personaSelection = document.getElementById('personaSelection');
            const personaLabel = document.getElementById('personaLabel');
            const isChatMode = document.getElementById('chatMode').checked;
            const isSkChatMode = document.getElementById('skChatMode').checked;
            
            if (personaSelection && personaSelection.style.display !== 'none') {
                // Remove existing theme classes
                personaSelection.classList.remove('traditional-theme', 'semantic-kernel-theme');
                
                // Apply consistent orange theme for persona section regardless of architecture
                if (isChatMode || isSkChatMode) {
                    if (personaLabel) {
                        personaLabel.className = 'form-label fw-semibold';
                        personaLabel.style.color = '#ef6c00';
                    }
                }
            }
        }

        function clearInput() {
            console.log('Clear input clicked'); // Debug log
            const promptInput = document.getElementById('promptInput');
            if (promptInput) {
                promptInput.value = '';
                promptInput.focus(); // Focus back on the input
                console.log('Input cleared'); // Debug log
            } else {
                console.error('Prompt input element not found');
            }
        }

        function clearOutput() {
            console.log('Clear output clicked'); // Debug log
            const outputArea = document.getElementById('outputArea');
            
            // Check all possible mode selections
            const mode = document.querySelector('input[name="modeSelection"]:checked')?.value;
            const skMode = document.querySelector('input[name="skModeSelection"]:checked')?.value;
            const activeMode = skMode || mode || 'search'; // Default to search if nothing selected
            
            if (outputArea) {
                let icon, modeText;
                
                // Determine icon and text based on active mode
                if (activeMode === 'sk_search') {
                    icon = 'search-heart';
                    modeText = 'Semantic Kernel query results';
                } else if (activeMode === 'sk_chat') {
                    icon = 'robot';
                    modeText = 'Semantic Kernel prompt results';
                } else if (activeMode === 'chat') {
                    icon = 'chat-text';
                    modeText = 'prompt results';
                } else {
                    icon = 'search';
                    modeText = 'query results';
                }
                
                outputArea.innerHTML = `
                    <div class="text-center text-muted py-4">
                        <i class="bi bi-${icon} display-6 mb-2"></i>
                        <p>Your ${modeText} will appear here</p>
                    </div>
                `;
                console.log('Output cleared for mode:', activeMode); // Debug log
            } else {
                console.error('Output area element not found');
            }
        }

        // Add event listeners when the document loads
        document.addEventListener('DOMContentLoaded', function() {
            // Add event listeners for mode changes
            document.querySelectorAll('input[name="modeSelection"]').forEach(radio => {
                radio.addEventListener('change', updateModeUI);
            });
            document.querySelectorAll('input[name="skModeSelection"]').forEach(radio => {
                radio.addEventListener('change', updateModeUI);
            });
            
            // Add event listeners for persona changes
            document.querySelectorAll('input[name="personaSelection"]').forEach(radio => {
                radio.addEventListener('change', updatePersonaUI);
            });
            
            // Initialize UI on page load
            updateModeUI();
            updatePersonaUI();
        });
    </script>
</body>
</html>
